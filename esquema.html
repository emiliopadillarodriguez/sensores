<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Esquema sala de calderas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root{
      --bg:#0b1220;      /* oscuro, no negro */
      --panel:#0f172a;
      --fg:#e5e7eb;
      --line:#1e293b;
    }

    body{
      margin:0;
      font-family: system-ui, Arial, sans-serif;
      background: var(--bg);
      color: var(--fg);
    }

    header{
      position: sticky;
      top: 0;
      z-index: 10;
      background: var(--panel);
      border-bottom: 1px solid var(--line);
      padding: 8px 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    header b{ font-size:14px; }

    button{
      padding: 6px 10px;
      font-size: 13px;
      border: 1px solid var(--line);
      border-radius: 8px;
      background: var(--panel);
      color: var(--fg);
      cursor: pointer;
    }
    button:hover{ background:#111827; }

    #status{
      margin-left:auto;
      font-size:12px;
      color:#94a3b8;
    }

    /* CONTENEDOR */
    #viewer{
      width:100vw;
      height: calc(100vh - 48px);
      overflow:auto;
      background: var(--bg);
    }

    /* SVG embebido */
    #svgObj{
      display:block;
      transform-origin: top left;
    }
  </style>
</head>

<body>

<header>
  <b>Esquema BMS · Sala de Calderas</b>

  <button onclick="zoomIn()">Zoom +</button>
  <button onclick="zoomOut()">Zoom −</button>
  <button onclick="fit()">Ajustar</button>

  <span id="status">Cargando…</span>
</header>

<div id="viewer">
  <object id="svgObj"
          type="image/svg+xml"
          data="esquema_render.svg?t=<?=Date.now()?>">
  </object>
</div>

<script>
  const obj = document.getElementById("svgObj");
  const viewer = document.getElementById("viewer");
  const statusEl = document.getElementById("status");

  let scale = 1;

  function applyZoom(){
    obj.style.transform = `scale(${scale})`;
    statusEl.textContent = `Zoom ${Math.round(scale*100)}%`;
  }

  function zoomIn(){ scale=Math.min(scale*1.15,6); applyZoom(); }
  function zoomOut(){ scale=Math.max(scale/1.15,0.15); applyZoom(); }

  function fit(){
    const svg = obj.contentDocument?.documentElement;
    if(!svg) return;

    const iw = svg.viewBox.baseVal.width || svg.getBoundingClientRect().width;
    const ih = svg.viewBox.baseVal.height || svg.getBoundingClientRect().height;
    const vw = viewer.clientWidth;
    const vh = viewer.clientHeight;

    scale = Math.min(vw/iw, vh/ih) * 0.97;
    applyZoom();
    viewer.scrollTop = 0;
    viewer.scrollLeft = 0;
  }

  /* ========= CLAVE: recolorizar SOLO líneas negras ========= */
  function recolorSVG(){
    const svg = obj.contentDocument;
    if(!svg) return;

    const elements = svg.querySelectorAll("*");

    elements.forEach(el=>{
      const stroke = el.getAttribute("stroke");
      const fill = el.getAttribute("fill");

      // Líneas negras → blancas
      if(stroke && (stroke === "#000" || stroke === "#000000" || stroke === "black")){
        el.setAttribute("stroke", "#ffffff");
      }

      // Textos negros → blancos (pero no rellenos decorativos)
      if(el.tagName === "text" && fill &&
         (fill === "#000" || fill === "#000000" || fill === "black")){
        el.setAttribute("fill", "#ffffff");
      }
    });
  }

  obj.onload = () => {
    statusEl.textContent = "SVG cargado";
    recolorSVG();   // ⭐ SOLO líneas negras
    fit();
  };

  obj.onerror = () => {
    statusEl.textContent = "ERROR cargando SVG";
  };
</script>

</body>
</html>
